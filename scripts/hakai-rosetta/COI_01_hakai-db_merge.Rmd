---
title: "hakai-rosetta"
author: "Kate Sheridan"
date: "8/6/2021"
output: html_document
---

# Setting up the master database and 'Rosetta Stone'

June 2022 note: as of right now I will need an updated database, etc. This script was dropped into taxonomy_keys from another repository with the output from the merge; as of today it is almost a year old. 
One adjustment I am making here is that this script will only be for the merging of files in the database(s). So it can be skipped entirely if an already-clean version of the merge exists.


```{r include=FALSE}
library(tidyverse)
library(dplyr)
library(stringr)
library(janitor)
library(data.table)
library(here)

# here filepaths
hakai_blast <- here('species_lists', 'hakai', '2021_blast-db')
```

## 1. Merging the multiple files comprising the Hakai Institute COI eDNA barcode database


Load-in for this database is relatively complicated. There are two sources -- the sequences from Hakai itself and the sequences from BOLD/NCBI. They have to be read in separately, combined, and higher taxonomy assigned. The files here were updated August 2021 and may need updating. 

It may take a while to load the bold_genbank files as they tend to be large. Also, it says that it contains the Hakai barcodes but I'm going to merge the two anyway, it seems to be either missing some or is having trouble finding them when I search.

```{r load-in}
#these are all Hakai's personally barcoded samples
#includes internal codes, taxonomic information, and collection locality
hakailist <- read.csv(here(hakai_blast,
                           'All_Hakai_Marine_Samples_March2021-WithCOI.csv')) %>% clean_names()

#this is their 2020 taxon mapping file from BOLD and Genbank
#there are no column names in this file
## update: this might actually be a newer file? compare to file above?
bold_genbank_taxa <- read.delim(here(hakai_blast,
                           'CO1.BOLD_genbank_combined.taxa_map.w_hakai_barcodes.sunday_lab.txt'))

not_mm <- read_csv(here(hakai_blast, 'not-marine-metazoa_db-filter.csv'))
```

## Filter lists

I'm heavily filtering the data I'm working with at the moment to taxa of interest = *marine metazoans*. I want to retain only sequences/identities from marine animals, as this is what we will be looking for in our eDNA. The rest will all be filtered out of analysis, or represents contamination/controls.

This list is exclusion instead of keep in the case that the database is expanded in the future. I can't predict what to keep later, but 'Japygidae' will never be marine, for instance.

NOTE: I have removed all birds (V6 == 'Aves') here. This may be undesirable. We will have to determine if there are birds we want to keep. I have also removed all insects (V6 == 'Insecta'), which may also be undesirable. I did not remove Acari as mites may show up in the data. However, it is not filtered to marine-only mites as I am not familiar with their taxonomy.

Organisms selected to filter are in a csv "not-marine-metazoa_db-filter.csv" which is separate from the regular key, as it is for filtering the database itself rather than BLAST results. I may need to make a longer version by unique accession number as entries with both bold and genbank IDs often have the two separated with a | rather than uniquely identified, but this will not change the key at just the taxonomy stage.


```{r clean-bold-genbank}
# extract problem entries
no_record <- bold_genbank_taxa %>%
  filter((is.na(kingdom)) | ((class == "" & genus == "")))  %>%
  select(accession, taxonID, phylum) %>% 
  separate(accession, into = c('accession_1','accession_2'), sep = '[|]', fill = 'right') %>%
  mutate(across(.cols = everything(),
                .fns = ~ na_if(., "")))

write.csv(no_record, here(rosetta, 'problems', 'not_found', '20220716_db_accessions_no-id.csv'))

# clean the bold_genbank database and subset to only marine metazoa
bold_genbank_taxa2 <- bold_genbank_taxa %>%
  subset(kingdom == "Metazoa") %>%
  filter(!(phylum == "")) %>%
  filter(!(class == "" & genus == "")) %>%
  #filter for marine metazoa using list
  filter(!(class %in% not_mm$taxa | order %in% not_mm$taxa | family %in% not_mm$taxa)) %>%
  mutate(across(.cols = everything(),
                .fns = ~ na_if(., ""))) %>%
  # generate identification column that is lowest possible ID
  mutate(identification = coalesce(species, genus)) %>%
  mutate(identification = coalesce(identification, family)) %>%
  mutate(identification = coalesce(identification, order)) %>%
  mutate(identification = coalesce(identification, class)) %>%
  mutate(identification = coalesce(identification, phylum)) %>%
  clean_names()

```


The Hakai list also needs sorting. There are many extra columns that may not be needed, and there are a few algae to remove.

Here I am also making a csv version that is reduced for other analyses/species lists.

```{r sort hakailist}
#reduce number of columns for other kinds of analysis
hakailist <- hakailist %>%
  select(identification, sample_id, bin,
         phylum, class, order, family, genus, species,
         state_province, region, sector, exact_site, lat, lon) %>%
  filter(!(class %in% not_mm$taxa | order %in% not_mm$taxa | family %in% not_mm$taxa |
             phylum %in% not_mm$taxa)) %>%
    mutate(across(.cols = everything(),
                .fns = ~ na_if(., "")))

# write out the hakai records with coords for later analysis
write_csv(hakailist, here(hakai_blast, '20220716_hakai_all_marine_samples-metazoa.csv'))
```

## Merge bold-genbank and Hakai

Note here that right now my regex call is a mess. This is fine for now because it works and I havent had a chance to assess where the issues in the other script were coming from (calling multiple removes in the same call had unexpected results). Goal in the future is to make a .csv with these calls so that I can load it in and say 'if in csv, remove', but for now brute force is ok. I'm slowly seeing the patterns.

Also a key note here is that the order in which the removals are made has a really important effect on the results. I suspect that the unexpected behavior from the previous scripts had to do with the calls not occuring in the order I laid out, which means there may need to be another strategy considered even when the patterns are better identified and CSV made.

I will also have to remove all the calls and add them in one by one to find the outdated ones. I have added some newer regex towards the top over hte course of this process that renders lower calls unnecessary. However I do not have time right now to figure that out as this database needs to be cleaned ASAP so that I can make my ESA poster. Future Kate, have fun lolololol.

For future me this is my process right now:
- separate the unique entries by lowest taxonomy only
- run current iteration
- sort by fixed identification so that same things cluster together; easier to see problems
- manually scroll and eyeball problems
- add to regex
- rinse and repeat

I am mostly sorting with sp. because most of the problems are coming from varieties etc that are incomplete identifications. Most of the common issues eg var. gen. cf. aff. will get searched over time but sp. has been the most informative.


```{r merge and clean boldgb and hakai}
#Despite trying several varieties of join the best way to do it here
bold_gb_hakai <- full_join(hakailist, bold_genbank_taxa2) %>%
  select(!(c(state_province, region, sector, exact_site, lat, lon, superkingdom, kingdom))) %>%
  relocate(c(accession, taxon_id), .before = phylum)

# write if needed
write.csv(bold_gb_hakai, here(hakai_blast,
                             '20220716_hakai_bold_gbif_database_raw.csv'))
#read back in to save memory
bold_gb_hakai <- read_csv(here(hakai_blast,
                             '20220716_hakai_bold_gbif_database_raw.csv'))[-1]

# for this cleaning we just want unique identifications, no id#s
bold_gb_hakai2 <- bold_gb_hakai %>%
  mutate(verbatim_identification = identification) %>%
  #narrow it to make it go faster, rejoin later
  select(identification, verbatim_identification) %>%
  distinct() %>%
  # for whatever reason running a string of calls at once
  ## introduced typos into the mifish database so we'll do it one by one
  # shorthand for uncertain IDs
  mutate(identification = str_remove_all(identification, "(sp\\. )")) %>%
  mutate(identification = str_remove_all(identification, "(sp\\.)$")) %>%
  mutate(identification = str_remove_all(identification, "(_sp_)")) %>%
  mutate(identification = str_remove_all(identification, "(cf\\. )")) %>%
  mutate(identification = str_remove_all(identification, "( aff\\.)")) %>%
  mutate(identification = str_remove_all(identification, "^(aff\\. )")) %>%
  mutate(identification = str_remove_all(identification, "( gen)$")) %>%
  mutate(identification = str_remove_all(identification, "( gen )")) %>%
  mutate(identification = str_remove_all(identification, "( gen\\. )")) %>%
  mutate(identification = str_remove_all(identification, "( fam.)")) %>%
  mutate(identification = str_remove_all(identification, "( Var)$")) %>%
  mutate(identification = str_remove_all(identification, "( var\\.)")) %>%
  mutate(identification = str_remove_all(identification, "( species complex)")) %>%
  mutate(identification = str_remove_all(identification, "( complex)$")) %>%
  mutate(identification = str_remove_all(identification, "( complex )")) %>%
  mutate(identification = str_remove_all(identification, "( complex type)")) %>%
  mutate(identification = str_remove_all(identification, "( complexnew)")) %>%
  mutate(identification = str_remove_all(identification, "( complexc)")) %>%
  mutate(identification = str_remove_all(identification, "( complex Nakuru)")) %>%
  mutate(identification = str_remove_all(identification, "( type )")) %>%
  mutate(identification = str_remove_all(identification, "(type[0-9]{2})")) %>%
  mutate(identification = str_remove_all(identification, "(-type)")) %>%
  mutate(identification = str_remove_all(identification, "( clade [A-Z]{1} )")) %>%
  mutate(identification = str_remove_all(identification, "( clade )")) %>%
  mutate(identification = str_remove_all(identification, "( clade-)")) %>%
  mutate(identification = str_remove_all(identification, "( clade)$")) %>%
  mutate(identification = str_remove_all(identification, "( clade[0-9]{1})")) %>%
  mutate(identification = str_remove_all(identification, "( hybrid )")) %>%
  mutate(identification = str_remove_all(identification, "( n\\.)")) %>%
  mutate(identification = str_remove_all(identification, "( n )")) %>%
  mutate(identification = str_remove_all(identification, "( new)$")) %>%
  mutate(identification = str_remove_all(identification, "( nov\\.)")) %>%
  mutate(identification = str_remove_all(identification, "( nov )")) %>%
  mutate(identification = str_remove_all(identification, "( unid\\.)")) %>%
  mutate(identification = str_remove_all(identification, "( sensu)")) %>%
  mutate(identification = str_remove_all(identification, "( Group )")) %>%
  mutate(identification = str_remove_all(identification, "( group )")) %>%
  mutate(identification = str_remove_all(identification, "( group)$")) %>%
  mutate(identification = str_remove_all(identification, "( gr\\.)")) %>%
  mutate(identification = str_remove_all(identification, "( nr\\.)")) %>%
  mutate(identification = str_remove_all(identification, "( voucher )")) %>%
  mutate(identification = str_remove_all(identification, "( lineage )")) %>%
  mutate(identification = str_remove_all(identification, "( und)$")) %>%
  mutate(identification = str_remove_all(identification, "( undet)$")) %>%
  mutate(identification = str_remove_all(identification, "( und_[0-9]{1})$")) %>%
  mutate(identification = str_remove_all(identification, "( unk)$")) %>%
  mutate(identification = str_remove_all(identification, "( unk_[0-9]{1})$")) %>%
  mutate(identification = str_remove_all(identification, "( intermediate )")) %>%
  mutate(identification = str_remove_all(identification, "( morphotype)")) %>%
  mutate(identification = str_remove_all(identification, "(_sample_)")) %>%
  mutate(identification = str_remove_all(identification, "( \\(nomen nudum\\))")) %>%
  #ID numbers
  mutate(identification = str_remove_all(identification, " [A-Z].*[A-Z]")) %>%
  mutate(identification = str_remove_all(identification, "([0-9]{4}[a-z]{1})")) %>%
  mutate(identification = str_remove_all(identification, "([0-9]{1}[a-z]{1})")) %>%
  mutate(identification = str_remove_all(identification, "( [A-Z]{1}[a-z]*[0-9])")) %>%
  mutate(identification = str_remove_all(identification, "([A-Z]+[0-9])")) %>%
  mutate(identification = str_remove_all(identification, "[[:digit:]]")) %>%
  mutate(identification = str_remove_all(identification, "( [A-Z]{1})$")) %>%
  mutate(identification = str_remove_all(identification, "( [A-Z]{2})$")) %>%
  mutate(identification = str_remove_all(identification, "([A-Z]{1})$")) %>%
  mutate(identification = str_remove_all(identification, "([A-Z]{2})$")) %>%
  mutate(identification = str_remove_all(identification, "([A-Z]{2}-)")) %>%
  mutate(identification = str_remove_all(identification, "(-[A-Z]{1})")) %>%

  mutate(identification = str_remove_all(identification, "-")) %>%
  mutate(identification = str_remove_all(identification, "'")) %>%
  mutate(identification = str_remove_all(identification, ",")) %>%
  mutate(identification = str_remove_all(identification, ":")) %>%
  mutate(identification = str_remove_all(identification, "_")) %>%
  mutate(identification = str_remove_all(identification, "\\.")) %>%
  mutate(identification = str_remove_all(identification, "/")) %>%
  mutate(identification = str_remove_all(identification, "\\#")) %>%
  mutate(identification = str_remove_all(identification, "&")) %>%
  #fragments of words
  mutate(identification = str_remove_all(identification, "( Amb)$")) %>%
  mutate(identification = str_remove_all(identification, "( Ansp)$")) %>%
  mutate(identification = str_remove_all(identification, "( Anem)$")) %>%
  mutate(identification = str_remove_all(identification, "( bn)$")) %>%
  mutate(identification = str_remove_all(identification, "( Cam)$")) %>%
  mutate(identification = str_remove_all(identification, "( Cy)$")) %>%
  mutate(identification = str_remove_all(identification, "( Lac)$")) %>%
  mutate(identification = str_remove_all(identification, "( Taif)$")) %>%
  mutate(identification = str_remove_all(identification, "( To)$")) %>%
  mutate(identification = str_remove_all(identification, "( kas)$")) %>%
  mutate(identification = str_remove_all(identification, "( Po)$")) %>%
  mutate(identification = str_remove_all(identification, "( kcm)$")) %>%
  mutate(identification = str_remove_all(identification, "( Izu)$")) %>%
  mutate(identification = str_remove_all(identification, "( Lau)$")) %>%
  mutate(identification = str_remove_all(identification, " MOLL")) %>%
  mutate(identification = str_remove_all(identification, "(AM)")) %>%
  mutate(identification = str_remove_all(identification, "(KS)")) %>%
  mutate(identification = str_remove_all(identification, "(M)$")) %>%
  mutate(identification = str_remove_all(identification, "(AV)")) %>%
  mutate(identification = str_remove_all(identification, "(AC)")) %>%
  mutate(identification = str_remove_all(identification, "(AU)")) %>%
  mutate(identification = str_remove_all(identification, "( auip)$")) %>%
  mutate(identification = str_remove_all(identification, "(AL)")) %>%
  mutate(identification = str_remove_all(identification, "( AMVK)$")) %>%
  mutate(identification = str_remove_all(identification, "(AMPE)")) %>%
  mutate(identification = str_remove_all(identification, "app\\)")) %>%
  mutate(identification = str_remove_all(identification, "(AS)")) %>%
  mutate(identification = str_remove_all(identification, "(A)$")) %>%
  mutate(identification = str_remove_all(identification, "( A )")) %>%
  mutate(identification = str_remove_all(identification, "(B)$")) %>%
  mutate(identification = str_remove_all(identification, "( biv)$")) %>%
  mutate(identification = str_remove_all(identification, "( F)$")) %>%
  mutate(identification = str_remove_all(identification, "( FG)")) %>%
  mutate(identification = str_remove_all(identification, "( BB)$")) %>%
  mutate(identification = str_remove_all(identification, "(BM)")) %>%
  mutate(identification = str_remove_all(identification, "(BIO)")) %>%
  mutate(identification = str_remove_all(identification, "( a)$")) %>%
  mutate(identification = str_remove_all(identification, "( b)$")) %>%
  mutate(identification = str_remove_all(identification, "(\\(be\\))$")) %>%
  mutate(identification = str_remove_all(identification, "( c)$")) %>%
  mutate(identification = str_remove_all(identification, "(C)$")) %>%
  mutate(identification = str_remove_all(identification, "( cIWP)$")) %>%
  mutate(identification = str_remove_all(identification, "( C)$")) %>%
  mutate(identification = str_remove_all(identification, "C\\)")) %>%
  mutate(identification = str_remove_all(identification, "( CM)$")) %>%
  mutate(identification = str_remove_all(identification, "( d)$")) %>%
  mutate(identification = str_remove_all(identification, "(D)$")) %>%
  mutate(identification = str_remove_all(identification, "( e)$")) %>%
  mutate(identification = str_remove_all(identification, "( e )")) %>%
  mutate(identification = str_remove_all(identification, "(E)$")) %>%
  mutate(identification = str_remove_all(identification, "( \\(ECF\\))")) %>%
  mutate(identification = str_remove_all(identification, "( f )")) %>%
  mutate(identification = str_remove_all(identification, "( f)$")) %>%
  mutate(identification = str_remove_all(identification, "(Gh)$")) %>%
  mutate(identification = str_remove_all(identification, "(Ga)$")) %>%
  mutate(identification = str_remove_all(identification, "(Gb)$")) %>%
  mutate(identification = str_remove_all(identification, "( h)$")) %>%
  mutate(identification = str_remove_all(identification, "( hw)$")) %>%
  mutate(identification = str_remove_all(identification, "( ke)$")) %>%
  mutate(identification = str_remove_all(identification, "(JW)")) %>%
  mutate(identification = str_remove_all(identification, "(LEC)")) %>%
  mutate(identification = str_remove_all(identification, "( Mel)$")) %>%
  mutate(identification = str_remove_all(identification, "(MIO)")) %>%
  mutate(identification = str_remove_all(identification, "(MZM)")) %>%
  mutate(identification = str_remove_all(identification, "( MB)$")) %>%
  mutate(identification = str_remove_all(identification, "(MOZ)")) %>%
  mutate(identification = str_remove_all(identification, "( nsp)$")) %>%
  mutate(identification = str_remove_all(identification, "( o )")) %>%
  mutate(identification = str_remove_all(identification, "( o)$")) %>%
  mutate(identification = str_remove_all(identification, "( Odsp)$")) %>%
  mutate(identification = str_remove_all(identification, "( p )")) %>%
  mutate(identification = str_remove_all(identification, "( p)$")) %>%
  mutate(identification = str_remove_all(identification, "( Pia)")) %>%
  mutate(identification = str_remove_all(identification, "( pol)$")) %>%
  mutate(identification = str_remove_all(identification, "( ris)$")) %>%
  mutate(identification = str_remove_all(identification, "(RU)$")) %>%
  mutate(identification = str_remove_all(identification, "( spm)$")) %>%
  mutate(identification = str_remove_all(identification, "( Sspp)$")) %>%
  mutate(identification = str_remove_all(identification, "( te)$")) %>%
  mutate(identification = str_remove_all(identification, "( \\(te\\))$")) %>%
  mutate(identification = str_remove_all(identification, "( ww)$")) %>%
  mutate(identification = str_remove_all(identification, "(Zi)$")) %>%
  mutate(identification = str_remove_all(identification, "(Zu)$")) %>%
  mutate(identification = str_remove_all(identification, "(ZA)")) %>%
  mutate(identification = str_remove_all(identification, "(CH)")) %>%
  mutate(identification = str_remove_all(identification, "(BOLD)")) %>%
  mutate(identification = str_remove_all(identification, "(BIOUGB)")) %>%
  mutate(identification = str_remove_all(identification, "(COI)$")) %>%
  mutate(identification = str_remove_all(identification, "(BSH)")) %>%
  mutate(identification = str_remove_all(identification, "(BHLav)")) %>%
  mutate(identification = str_remove_all(identification, "(BHLv)")) %>%
  mutate(identification = str_remove_all(identification, "( FAKU)")) %>%
  mutate(identification = str_remove_all(identification, "( Lac)$")) %>%
  mutate(identification = str_remove_all(identification, "( LIGUDG)")) %>%
  mutate(identification = str_remove_all(identification, "( MN)")) %>%
  mutate(identification = str_remove_all(identification, "(MC)")) %>%
  mutate(identification = str_remove_all(identification, "( NSMTP)$")) %>%
  mutate(identification = str_remove_all(identification, "(NK)")) %>%
  mutate(identification = str_remove_all(identification, "(OHJew)")) %>%
  mutate(identification = str_remove_all(identification, "( RC)")) %>%
  mutate(identification = str_remove_all(identification, "(lspp)$")) %>%
  mutate(identification = str_remove_all(identification, "(Ispp)$")) %>%
  mutate(identification = str_remove_all(identification, "(SPl)")) %>%
  mutate(identification = str_remove_all(identification, "(SPI)")) %>%
  mutate(identification = str_remove_all(identification, "( S)$")) %>%
  mutate(identification = str_remove_all(identification, "( SCSN)$")) %>%
  mutate(identification = str_remove_all(identification, "(Tap)$")) %>%
  mutate(identification = str_remove_all(identification, "(Tar)$")) %>%
  mutate(identification = str_remove_all(identification, "(WOLV)")) %>%
  mutate(identification = str_remove_all(identification, "( YCMP)$")) %>%
  mutate(identification = str_remove_all(identification, "(Xin)$")) %>%
  mutate(identification = str_remove_all(identification, " undetR")) %>%
  mutate(identification = str_remove_all(identification, "( zpl)$")) %>%
  mutate(identification = str_remove_all(identification, "( spot)")) %>%
  mutate(identification = str_remove_all(identification, "( barred)")) %>%
  mutate(identification = str_remove_all(identification, " black")) %>%
  mutate(identification = str_remove_all(identification, "( blond)")) %>%
  mutate(identification = str_remove_all(identification, " bulky head")) %>%
  mutate(identification = str_remove_all(identification, "( chocolate)")) %>%
  mutate(identification = str_remove_all(identification, "( Cribrimorphlike)")) %>%
  mutate(identification = str_remove_all(identification, "( dwarf)")) %>%
  mutate(identification = str_remove_all(identification, "( eyes)$")) %>%
  mutate(identification = str_remove_all(identification, "( larva)")) %>%
  mutate(identification = str_remove_all(identification, "( green)")) %>%
  mutate(identification = str_remove_all(identification, "(prey of)")) %>%
  mutate(identification = str_remove_all(identification, "( Porcupine)")) %>%
  mutate(identification = str_remove_all(identification, " orangecollar")) %>%
  mutate(identification = str_remove_all(identification, "( pinnules)$")) %>%
  mutate(identification = str_remove_all(identification, "( rosy)")) %>%
  mutate(identification = str_remove_all(identification, "( sagami)")) %>%
  mutate(identification = str_remove_all(identification, "( crescent)$")) %>%
  mutate(identification = str_remove_all(identification, "( ophiolite)$")) %>%
  mutate(identification = str_remove_all(identification, "( spiral)$")) %>%
  mutate(identification = str_remove_all(identification, " sawfin shiner")) %>%
  mutate(identification = str_remove_all(identification, "( white)")) %>%
  mutate(identification = str_remove_all(identification, "( White)")) %>%
  mutate(identification = str_remove_all(identification, "( \\(White \\))")) %>%
  mutate(identification = str_remove_all(identification, "( Yellow)")) %>%
  mutate(identification = str_remove_all(identification, "( yellowback)")) %>%
  mutate(identification = str_remove_all(identification, "( yellowcollar)")) %>%
  mutate(identification = str_remove_all(identification, "( yellowpatch)")) %>%
  mutate(identification = str_remove_all(identification, "( chimpanzeecA)")) %>%
  mutate(identification = str_remove_all(identification, "( gibbongA)")) %>%
  mutate(identification = str_remove_all(identification, " environmental sample")) %>%
  mutate(identification = str_remove_all(identification, "( ex Sooretamys angouya)$")) %>%
  mutate(identification = str_remove_all(identification, " brassy jumprock")) %>%
  mutate(identification = str_remove_all(identification, "(collar)")) %>%
  mutate(identification = str_remove_all(identification, "( yellowback)")) %>%
  mutate(identification = str_remove_all(identification, " nudepalp")) %>%
  mutate(identification = str_remove_all(identification, "(palp)$")) %>%
  mutate(identification = str_remove_all(identification, "( stri)$")) %>%
  mutate(identification = str_remove_all(identification, " undetRAC")) %>%
  # localities that didn't get filtered
  mutate(identification = str_remove_all(identification, " acific")) %>%
  mutate(identification = str_remove_all(identification, "( alearics)$")) %>%
  mutate(identification = str_remove_all(identification, "( anaries)$")) %>%
  mutate(identification = str_remove_all(identification, "( asque)$")) %>%
  mutate(identification = str_remove_all(identification, "( akabo)$")) %>%
  mutate(identification = str_remove_all(identification, "( Amami)")) %>%
  mutate(identification = str_remove_all(identification, "( et al)")) %>%
  mutate(identification = str_remove_all(identification, "( ausc)$")) %>%
  mutate(identification = str_remove_all(identification, " Amamilevii")) %>%
  mutate(identification = str_remove_all(identification, " Achenwald")) %>%
  mutate(identification = str_remove_all(identification, " Akaebi")) %>%
  mutate(identification = str_remove_all(identification, " Acla")) %>%
  mutate(identification = str_remove_all(identification, " Argis")) %>%
  mutate(identification = str_remove_all(identification, " Austria")) %>%
  mutate(identification = str_remove_all(identification, " Antalaha")) %>%
  mutate(identification = str_remove_all(identification, " Albanien")) %>%
  mutate(identification = str_remove_all(identification, " Almenara")) %>%
  mutate(identification = str_remove_all(identification, " Bacharach")) %>%
  mutate(identification = str_remove_all(identification, " Beforana")) %>%
  mutate(identification = str_remove_all(identification, "\\(Bangkok\\)")) %>%
  mutate(identification = str_remove_all(identification, " Betampona")) %>%
  mutate(identification = str_remove_all(identification, " Blaubeuren")) %>%
  mutate(identification = str_remove_all(identification, " Blackmore")) %>%
  mutate(identification = str_remove_all(identification, " Balkan")) %>%
  mutate(identification = str_remove_all(identification, " Bangladesh")) %>%
  mutate(identification = str_remove_all(identification, " Bocas")) %>%
  mutate(identification = str_remove_all(identification, " Borneo")) %>%
  mutate(identification = str_remove_all(identification, " Bugwe")) %>%
  mutate(identification = str_remove_all(identification, " blueiver")) %>%
  mutate(identification = str_remove_all(identification, " Beysehir")) %>%
  mutate(identification = str_remove_all(identification, " Boncourt")) %>%
  mutate(identification = str_remove_all(identification, " Calibasis")) %>%
  mutate(identification = str_remove_all(identification, " Caracol")) %>%
  mutate(identification = str_remove_all(identification, "( Cape)")) %>%
  mutate(identification = str_remove_all(identification, "( cific)$")) %>%
  mutate(identification = str_remove_all(identification, "( Cris)$")) %>%
  mutate(identification = str_remove_all(identification, " Cayman")) %>%
  mutate(identification = str_remove_all(identification, " Cambuta river")) %>%
  mutate(identification = str_remove_all(identification, " Cameta")) %>%
  mutate(identification = str_remove_all(identification, " casmbe")) %>%
  mutate(identification = str_remove_all(identification, "( chnak)")) %>%
  mutate(identification = str_remove_all(identification, " Caroline Spring")) %>%
  mutate(identification = str_remove_all(identification, " Chiriqui")) %>%
  mutate(identification = str_remove_all(identification, " Contulmo")) %>%
  mutate(identification = str_remove_all(identification, " Dabaisha")) %>%
  mutate(identification = str_remove_all(identification, " Dorsey")) %>%
  mutate(identification = str_remove_all(identification, " Dawson \\(\\)")) %>%
  mutate(identification = str_remove_all(identification, "( depth)")) %>%
  mutate(identification = str_remove_all(identification, " Degbf")) %>%
  mutate(identification = str_remove_all(identification, " Doeggingen")) %>%
  mutate(identification = str_remove_all(identification, " Dossenbach")) %>%
  mutate(identification = str_remove_all(identification, " Djevojacka")) %>%
  mutate(identification = str_remove_all(identification, " Dunlopustralia")) %>%
  mutate(identification = str_remove_all(identification, " Eberstadt")) %>%
  mutate(identification = str_remove_all(identification, " Essequibo")) %>%
  mutate(identification = str_remove_all(identification, " Farias")) %>%
  mutate(identification = str_remove_all(identification, " Faraway")) %>%
  mutate(identification = str_remove_all(identification, " Florida")) %>%
  mutate(identification = str_remove_all(identification, "( Fiji)")) %>%
  mutate(identification = str_remove_all(identification, " France")) %>%
  mutate(identification = str_remove_all(identification, " Fujian")) %>%
  mutate(identification = str_remove_all(identification, " Fareteuiraahiti")) %>%
  mutate(identification = str_remove_all(identification, " Girona")) %>%
  mutate(identification = str_remove_all(identification, " Gogdeliprings")) %>%
  mutate(identification = str_remove_all(identification, " Halton")) %>%
  mutate(identification = str_remove_all(identification, " Harvey")) %>%
  mutate(identification = str_remove_all(identification, " Hungary")) %>%
  mutate(identification = str_remove_all(identification, " Halsp")) %>%
  mutate(identification = str_remove_all(identification, " hachijo")) %>%
  mutate(identification = str_remove_all(identification, " Hinterfallbach")) %>%
  mutate(identification = str_remove_all(identification, " Iguassub")) %>%
  mutate(identification = str_remove_all(identification, " Incheon")) %>%
  mutate(identification = str_remove_all(identification, " Inji")) %>%
  mutate(identification = str_remove_all(identification, " Israel")) %>%
  mutate(identification = str_remove_all(identification, " Ivoloina")) %>%
  mutate(identification = str_remove_all(identification, " \\(Johor\\)")) %>%
  mutate(identification = str_remove_all(identification, " Karianga")) %>%
  mutate(identification = str_remove_all(identification, " Kawakatsu")) %>%
  mutate(identification = str_remove_all(identification, " Keith")) %>%
  mutate(identification = str_remove_all(identification, " Kolodyne")) %>%
  mutate(identification = str_remove_all(identification, "\\(Khor Zawrah\\)")) %>%
  mutate(identification = str_remove_all(identification, "( Kuro)")) %>%
  mutate(identification = str_remove_all(identification, " Kairei Field")) %>%
  mutate(identification = str_remove_all(identification, " Lleida")) %>%
  mutate(identification = str_remove_all(identification, " Lake Ohrid")) %>%
  mutate(identification = str_remove_all(identification, " Lau Basin")) %>%
  mutate(identification = str_remove_all(identification, " Kermadec")) %>%
  mutate(identification = str_remove_all(identification, " Kongou")) %>%
  mutate(identification = str_remove_all(identification, " Lucien")) %>%
  mutate(identification = str_remove_all(identification, " Laguna de Labradores")) %>%
  mutate(identification = str_remove_all(identification, " Lagoa Caconde")) %>%
  mutate(identification = str_remove_all(identification, "( Laos)$")) %>%
  mutate(identification = str_remove_all(identification, " Loisia")) %>%
  mutate(identification = str_remove_all(identification, " Lorch")) %>%
  mutate(identification = str_remove_all(identification, " Lilliput")) %>%
  mutate(identification = str_remove_all(identification, " Malpais Spring")) %>%
  mutate(identification = str_remove_all(identification, " Madagascar")) %>%
  mutate(identification = str_remove_all(identification, " Manjavacas")) %>%
  mutate(identification = str_remove_all(identification, " Makira")) %>%
  mutate(identification = str_remove_all(identification, " Malili")) %>%
  mutate(identification = str_remove_all(identification, " Manombo")) %>%
  mutate(identification = str_remove_all(identification, " Moehren")) %>%
  mutate(identification = str_remove_all(identification, " Maranhao")) %>%
  mutate(identification = str_remove_all(identification, " Martinique")) %>%
  mutate(identification = str_remove_all(identification, " Maranho")) %>%
  mutate(identification = str_remove_all(identification, " Mehuin")) %>%
  mutate(identification = str_remove_all(identification, " Mile")) %>%
  mutate(identification = str_remove_all(identification, " Monobe")) %>%
  mutate(identification = str_remove_all(identification, " Myanmar")) %>%
  mutate(identification = str_remove_all(identification, " Miya")) %>%
  mutate(identification = str_remove_all(identification, "( Mel)$")) %>%
  mutate(identification = str_remove_all(identification, " Mexico")) %>%
  mutate(identification = str_remove_all(identification, " Montenegro")) %>%
  mutate(identification = str_remove_all(identification, " Madeira")) %>%
  mutate(identification = str_remove_all(identification, " Nogumai")) %>%
  mutate(identification = str_remove_all(identification, "( ndalusia)$")) %>%
  mutate(identification = str_remove_all(identification, "(Nakuru)$")) %>%
  mutate(identification = str_remove_all(identification, "( Negro)$")) %>%
  mutate(identification = str_remove_all(identification, " Nguru")) %>%
  mutate(identification = str_remove_all(identification, " Neckarrems")) %>%
  mutate(identification = str_remove_all(identification, " Nevada")) %>%
  mutate(identification = str_remove_all(identification, " Oberminseln")) %>%
  mutate(identification = str_remove_all(identification, " Oheimb")) %>%
  mutate(identification = str_remove_all(identification, " Oyapock")) %>%
  mutate(identification = str_remove_all(identification, " Oshoro")) %>%
  mutate(identification = str_remove_all(identification, "( orocco)$")) %>%
  mutate(identification = str_remove_all(identification, "( ortugal)$")) %>%
  mutate(identification = str_remove_all(identification, " Oregon")) %>%
  mutate(identification = str_remove_all(identification, " Oman")) %>%
  mutate(identification = str_remove_all(identification, " Oreobasis")) %>%
  mutate(identification = str_remove_all(identification, " orinocot")) %>%
  mutate(identification = str_remove_all(identification, " Patrocnica spring")) %>%
  mutate(identification = str_remove_all(identification, " Peru")) %>%
  mutate(identification = str_remove_all(identification, " Pakistan")) %>%
  mutate(identification = str_remove_all(identification, " Perlen")) %>%
  mutate(identification = str_remove_all(identification, " Persia")) %>%
  mutate(identification = str_remove_all(identification, " Pannawonica")) %>%
  mutate(identification = str_remove_all(identification, " Philippines")) %>%
  mutate(identification = str_remove_all(identification, " Paraguay")) %>%
  mutate(identification = str_remove_all(identification, " Pamisou river springs")) %>%
  mutate(identification = str_remove_all(identification, " Pindare")) %>%
  mutate(identification = str_remove_all(identification, " Pohnpei")) %>%
  mutate(identification = str_remove_all(identification, "( Pol)$")) %>%
  mutate(identification = str_remove_all(identification, " Pomablue")) %>%
  mutate(identification = str_remove_all(identification, " Puyehue")) %>%
  mutate(identification = str_remove_all(identification, " Quebec")) %>%
  mutate(identification = str_remove_all(identification, "(RCPeru)")) %>%
  mutate(identification = str_remove_all(identification, "(RCPanama)")) %>%
  mutate(identification = str_remove_all(identification, " Rio Supamo")) %>%
  mutate(identification = str_remove_all(identification, "( ribbean)$")) %>%
  mutate(identification = str_remove_all(identification, " Rheinfelden")) %>%
  mutate(identification = str_remove_all(identification, " Reversing Falls miniature")) %>%
  mutate(identification = str_remove_all(identification, " Ranomafana")) %>%
  mutate(identification = str_remove_all(identification, " Sanya")) %>%
  mutate(identification = str_remove_all(identification, " Singapore")) %>%
  mutate(identification = str_remove_all(identification, "\\(Singapore\\)")) %>%
  mutate(identification = str_remove_all(identification, " Schwangau")) %>%
  mutate(identification = str_remove_all(identification, "( \\(Sowerby \\))")) %>%
  mutate(identification = str_remove_all(identification, " South")) %>%
  mutate(identification = str_remove_all(identification, "( Sac)$")) %>%
  mutate(identification = str_remove_all(identification, " Stepian")) %>%
  mutate(identification = str_remove_all(identification, " Stepien")) %>%
  mutate(identification = str_remove_all(identification, "( Suji)")) %>%
  mutate(identification = str_remove_all(identification, "( Suiyo)")) %>%
  mutate(identification = str_remove_all(identification, " Surinam")) %>%
  mutate(identification = str_remove_all(identification, " Temuco")) %>%
  mutate(identification = str_remove_all(identification, " Tocantins")) %>%
  mutate(identification = str_remove_all(identification, " Tobogan")) %>%
  mutate(identification = str_remove_all(identification, " Tuirial")) %>%
  mutate(identification = str_remove_all(identification, " Tuirivang")) %>%
  mutate(identification = str_remove_all(identification, " Thailand")) %>%
  mutate(identification = str_remove_all(identification, " Tlawng")) %>%
  mutate(identification = str_remove_all(identification, " Taiwanese barbel steed")) %>%
  mutate(identification = str_remove_all(identification, " Taiwan")) %>%
  mutate(identification = str_remove_all(identification, " Tahiti")) %>%
  mutate(identification = str_remove_all(identification, " Mtahiti")) %>%
  mutate(identification = str_remove_all(identification, " Oroferoahiti")) %>%
  mutate(identification = str_remove_all(identification, " Piraeahiti")) %>%
  mutate(identification = str_remove_all(identification, " Punaruuahiti")) %>%
  mutate(identification = str_remove_all(identification, " Tereiaahiti")) %>%
  mutate(identification = str_remove_all(identification, " Vaiaravaahiti")) %>%
  mutate(identification = str_remove_all(identification, " Tiscar")) %>%
  mutate(identification = str_remove_all(identification, " Tufi")) %>%
  mutate(identification = str_remove_all(identification, " Terryn")) %>%
  mutate(identification = str_remove_all(identification, " upperpring")) %>%
  mutate(identification = str_remove_all(identification, "( urcia)$")) %>%
  mutate(identification = str_remove_all(identification, " Vanuatu")) %>%
  mutate(identification = str_remove_all(identification, " Vevembe")) %>%
  mutate(identification = str_remove_all(identification, " Vermelho stream")) %>%
  mutate(identification = str_remove_all(identification, "( Wo)")) %>%
  mutate(identification = str_remove_all(identification, " Wangen")) %>%
  mutate(identification = str_remove_all(identification, "( zores)$")) %>%
  mutate(identification = str_remove_all(identification, " china ")) %>%
  
  mutate(identification = str_remove_all(identification, " from Polypogon monspeliensis")) %>%
  mutate(identification = str_remove_all(identification, "( \\(\\))$")) %>%
  
  
  
  #changing typos that were introduced
  mutate(identification = str_replace_all(identification, c('  ' = ' ', 'Octopuso' ='Octopus',
                                                            'Callistoctopuso' = 'Callistoctopus',
                                                            ' variabilis complex' = 'variabilis',
                                                            'Limaxhiavenna' = 'Limax',
                                                            'Limaxpennine' = 'Limax',
                                                            'Brochiverrucaa' = 'Brochiverruca',
                                                            'Rhamphochromisw' = 'Rhamphochromis',
                                                            'Tiwaripotamonb' = 'Tiwaripotamon',
                                                            'Seguenzialevii' = 'Seguenzia',
                                                            'negroLBP' = 'negro',
                                                            'orinocoAUMt' = 'orinoco',
                                                            'Tetragonopterusa' = 'Tetragonopterus',
                                                            'Tetragonopterusc' = 'Tetragonopterus',
                                                            'hianstype' = 'hians',
                                                            'Acanthocobitisoach' = 'Acanthocobitis',
                                                            'Aeglaa' = 'Aegla', 
                                                            'Aequoreaa' = 'Aequorea', 
                                                            'Antecaridinaimor' = 'Antecaridina',
                                                            'Asplanchnaa' = 'Asplanchna',
                                                            'Asplanchnab' = 'Asplanchna',
                                                            'Asterostegusype' = 'Asterostegus',
                                                            'AeolidiidaeA' = 'Aeolidiidae',
                                                            'Aeolidiidaealba' = 'Aeolidiida ealba',
                                                            'Aeolidiidaejaponica' = 'Aeolidiidae japonica',
                                                            'AoridaeAoridaeNZD' = 'Aoridae',
                                                            'AsbestoplumaA' = 'Asbestopluma',
                                                            'AsbestoplumaB' = 'Asbestopluma',
                                                            'Astroblepusag' = 'Astroblepus',
                                                            'Austrochloritiscres' = 'Austrochloritis',
                                                            'Austropyrgusastr' = 'Austropyrgus',
                                                            'Awaous Awaou' = 'Awaous',
                                                            'Bathygobiusaneiro' = 'Bathygobius',
                                                            'Bulinussland' = 'Bulinus',
                                                            'Carcharhinusarc' = 'Carcharhinus',
                                                            'Cerebratulusay' = 'Cerebratulus',
                                                            'Cepheidaetokiki' = 'Cepheidae',
                                                            'Clupeoideshraya' = 'Clupeoides',
                                                            'Contradensec' = 'Contradens',
                                                            'Copidognathusc' = 'Copidognathus',
                                                            'Corbiculaorb' = 'Corbicula',
                                                            'Coregonusa' = 'Coregonus',
                                                            'CyphocarididaeCyphocarididaeNZD' = 'Cyphocarididae',
                                                            'Cauloramphusaeng' = 'Cauloramphus',
                                                            'Cryptocentrusyers \\)' = 'Cryptocentrus',
                                                            'maruadsitype' = 'maruadsi',
                                                            'DexaminidaeDexaminidaeNZD' = 'Dexaminidae',
                                                            'Diopisthoporusnsp' = 'Diopisthoporus',
                                                            'Discosomaisc' = 'Discosoma',
                                                            'Ensidensec' = 'Ensidens',
                                                            'Epiactisnid' = 'Epiactis',
                                                            'Etmopterustevens' = 'Etmopterus',
                                                            'Eurythenesuryt' = 'Eurythenes',
                                                            'EusiridaeEusiridaeNZD' = 'Eusiridae',
                                                            'Fistularia petimbatype' = 'Fistularia petimba',
                                                            'Heleobiaaguna' = 'Helobia',
                                                            'Heleobiaali' = 'Helobia',
                                                            'Heleobiaebada' = 'Helobia',
                                                            'Heleobiaocas' = 'Helobia',
                                                            'Heleobiaonchali' = 'Helobia',
                                                            'Heleobiauilimari' = 'Helobia',
                                                            'Heleobiaur' = 'Helobia',
                                                            'Hirundichthysshop' = 'Hirundichthys',
                                                            'Henleaspm' = 'Henlea',
                                                            'IschyroceridaeIschyroceridaeNZD' = 'Ischyroceridae',
                                                            'Jugauga' = 'Juga',
                                                            'Knemidokoptesne' = 'Knemidokoptes',
                                                            'Leptocephalus type' = 'Leptocephalus',
                                                            'Lasaeaarbor' = 'Lasaea',
                                                            'Leptotrombidiumchigger' = 'Leptotrombidium',
                                                            'Limaxlps' = 'Limax',
                                                            'Lunellaustralia' = 'Lunella',
                                                            'LysianassidaeLysianassidaeNZD' = 'Lysianassidae',
                                                            'Lirceoluspring' = 'Lirceolus',
                                                            'Labeoiver' = 'Labeo',
                                                            'Macrostylisso' ='Macrostylis',
                                                            'Melamphaidae Melamphaes' = 'Melamphaidae',
                                                            'Nematomeniaol' = 'Nematomenia',
                                                            'OedicerotidaeOedicerotidaeNZD' = 'Oedicerotidae',
                                                            'Oreochromisshop' = 'Oreochromis',
                                                            'Oithonakkeshi' = 'Oithona',
                                                            'ParabathynellidaeA' = 'Parabathynellidae',
                                                            'westermanitype' = 'westermani',
                                                            'Photopectoralisaiwan' = 'Photopectoralis',
                                                            'PhoxocephalidaePhoxocephalidaeNZD' = 'Phoxocephalidae',
                                                            'Phymorhynchusala' = 'Phymorhynchus',
                                                            'Pilsbryoconchase' = 'Pilsbryoconcha',
                                                            'Plectostylusadi' = 'Plectostylus',
                                                            'Plectostylusal' = 'Plectostylus',
                                                            'Plectostyluseco' = 'Plectostylus',
                                                            'Plectostylush' = 'Plectostylus',
                                                            'Plectostylusncol' = 'Plectostylus',
                                                            'Plectostylusnes' ='Plectostylus',
                                                            'Plectostylusojas' = 'Plectostylus',
                                                            'Plectostylusosque' = 'Plectostylus',
                                                            'Plectostylusuermos' = 'Plectostylus',
                                                            'Plectostylusueules' = 'Plectostylus',
                                                            'Plectostylusuiles' = 'Plectostylus',
                                                            'PoeciliaAcla' = 'Poecilia',
                                                            'indicustype' = 'indicus',
                                                            'lineatustype' = 'lineatus',
                                                            'Poropuntiusian' = 'Poropuntius',
                                                            'Potamolithusaule' = 'Potamolithus',
                                                            'Pseudocalanuskkeshi' = 'Pseudocalanus',
                                                            'Pungitiustag' = 'Pungitius',
                                                            'Rhipicephaluswd' = 'Rhipicephalus',
                                                            'Rhodopeol' = 'Rhodope',
                                                            'argustype' = 'argus',
                                                            'Schizocarpushi' = 'Schizocarpus', 
                                                            'vosmeritype' = 'vosmeri',
                                                            'Sundasalanxhraya' = 'Sundasalanx',
                                                            'SynopiidaeSynopiidaeNZD' = 'Synopiidae',
                                                            'Thunnusrestaurant' = 'Thunnus',
                                                            'Typhlopseudothelphusayph' = 'Typhlopseudothelphusa'
                                                            ))) %>%
  

  mutate(identification = trimws(identification))
  
  

# to check
#bold_gb_hakai_sp <- bold_gb_hakai2 %>%
#  select(identification) %>%
#  distinct()



# merge clean column back in
bold_gb_hakai <- bold_gb_hakai %>%
  mutate(verbatim_identification = identification) %>%
  select(!(identification)) %>%
  left_join(bold_gb_hakai2) %>%
  relocate(c('identification', 'verbatim_identification'), .before = 'sample_id')


```

```{r read and write clean}
# write if needed
write.csv(bold_gb_hakai, here(hakai_blast, 
                              '20220718_hakai_bold_gbif_database_clean.csv'))

```
