---
title: "rosetta-match"
author: "Kate Sheridan"
date: "8/15/2021"
output: html_document
---

# Matching the rosetta stone with an output from taxonomy assignment

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(here)
```

## Read-in

### Most Recent Rosetta

```{r}
rosetta <- read.csv(here('hakaidata', '2021rosetta', 'taxize', 
                              '20210812_rosetta.csv'))
```

### Load in blast results that contain identifiers

this exact command may need to change in the future depending on what form those files take

```{r}
blast_results <- read.csv(here('hakaidata', '2021rosetta', 'test', 
                              'CO1_ASV_sequences.combined.blast.out'),
                          sep = '\t',
                          skip = 1,
                          header = FALSE,
                          col.names = c("query_ID", "subject",
                                        "subject_accession", "subject_taxonomy_ID",
                                        "identity_percentage", "coverage",
                                        "evalue", "bitscore",
                                        "source", "taxonomy"))
```


## Fix Blast results and rewrite

```{r}
#this separates subject accessions in the case that there are two for one
blast_results <- blast_results %>%
  separate(subject_accession, into = c('subject_accession1', 'subject_accession2'),
           remove = FALSE, sep = "\\|")

write.csv(blast_results, here('hakaidata', '2021rosetta', 'test', 
                              'blast_results.csv'))
```


todo
honestly this might be a python step now since i'll need to do multiple loops, then write the results to a csv. 
